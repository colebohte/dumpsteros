#!/bin/bash
# litter - The DumpsterOS text editor
# Nano-style interface, DumpsterOS aesthetic

VERSION="1.0"
FILE="$1"

# Colors
BOLD='\033[1m'
GREEN='\033[1;92m'
YELLOW='\033[1;33m'
PINK='\033[1;35m'
GRAY='\033[90m'
CYAN='\033[1;36m'
RST='\033[0m'
REV='\033[7m'

# If no file specified, prompt for one
if [ -z "$FILE" ]; then
    clear
    echo -e "${PINK}litter${RST} v${VERSION}"
    echo ""
    read -p "File to edit: " FILE
    if [ -z "$FILE" ]; then
        echo "No file specified"
        exit 1
    fi
fi

# Create empty file if doesn't exist
if [ ! -f "$FILE" ]; then
    touch "$FILE"
fi

# Get absolute path
FILE=$(realpath "$FILE")
FILENAME=$(basename "$FILE")

# Create temp working copy
TEMP_FILE="/tmp/litter_$$"
cp "$FILE" "$TEMP_FILE" 2>/dev/null || touch "$TEMP_FILE"

# Show splash briefly
clear
echo -e "${PINK}"
echo "    ██╗     ██╗████████╗████████╗███████╗██████╗ "
echo "    ██║     ██║╚══██╔══╝╚══██╔══╝██╔════╝██╔══██╗"
echo "    ██║     ██║   ██║      ██║   █████╗  ██████╔╝"
echo "    ██║     ██║   ██║      ██║   ██╔══╝  ██╔══██╗"
echo "    ███████╗██║   ██║      ██║   ███████╗██║  ██║"
echo "    ╚══════╝╚═╝   ╚═╝      ╚═╝   ╚══════╝╚═╝  ╚═╝"
echo -e "${RST}"
echo -e "${GRAY}The Dumpster OS's Vi-based Text Editor${RST}"
echo ""
echo -e "Editing: ${GREEN}$FILE${RST}"
sleep 1

# Simple vi wrapper with nano-style interface
clear
echo -e "${GRAY}╔══════════════════════════════════════════════════════════╗"
echo -e "║ ${PINK}litter${GRAY} - Editing: ${GREEN}${FILENAME}${GRAY}                           ║"
echo -e "╚══════════════════════════════════════════════════════════╝${RST}"
echo ""

# Launch vi
vi "$TEMP_FILE"

# After editing, check if modified
if ! cmp -s "$FILE" "$TEMP_FILE" 2>/dev/null; then
    echo ""
    read -p "Save changes? (Y/n) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Nn]$ ]]; then
        cp "$TEMP_FILE" "$FILE"
        echo -e "${GREEN}✓${RST} File saved: ${FILE}"
    else
        echo -e "${YELLOW}!${RST} Changes discarded"
    fi
else
    echo -e "${GRAY}No changes made${RST}"
fi

# Cleanup
rm -f "$TEMP_FILE"
