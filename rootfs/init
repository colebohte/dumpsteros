#!/bin/sh

# ===============================
# Dumpster OS Early Init
# ===============================

# Mount filesystems FIRST (only once)
/bin/mount -t proc proc /proc 2>/dev/null
/bin/mount -t sysfs sysfs /sys 2>/dev/null
/bin/mount -t devtmpfs devtmpfs /dev 2>/dev/null

# Suppress kernel messages to console
dmesg -n 1

# Load Terminus font
if [ -f /usr/share/consolefonts/ter-v16n.psf.gz ]; then
    setfont /usr/share/consolefonts/ter-v16n.psf.gz 2>/dev/null
fi

# Colors
RST='\033[0m'
BOLD='\033[1m'
GRAY='\033[90m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
RED='\033[1;31m'

clear

# Print header with vertical line
printf "${GRAY}│${RST}\n"
printf "${GRAY}│${RST} ${BOLD}Welcome to Dumpster OS${RST}\n"
printf "${GRAY}│${RST} ${GRAY}Developed by colebohte${RST}\n"
printf "${GRAY}│${RST} ${GRAY}Licensed under GNU General Public License v2.0${RST}\n"
printf "${GRAY}│${RST}\n"

# Show mount status
printf "${GRAY}│${RST} ${YELLOW}[+] Mounted /proc${RST} ${GREEN}OK${RST}\n"
printf "${GRAY}│${RST} ${YELLOW}[+] Mounted /sys${RST} ${GREEN}OK${RST}\n"
printf "${GRAY}│${RST} ${YELLOW}[+] Mounted /dev${RST} ${GREEN}OK${RST}\n"

# Start networking
printf "${GRAY}│${RST} ${YELLOW}[+] Starting network...${RST}"
if [ -f /etc/init.d/network ]; then
    /etc/init.d/network >/dev/null 2>&1 && printf " ${GREEN}OK${RST}\n" || printf " ${RED}FAIL${RST}\n"
else
    printf " ${RED}SKIP${RST}\n"
fi

# OS info
if [ -f /etc/os-release ]; then
    . /etc/os-release
    os="$NAME $VERSION ($VERSION_CODENAME)"
else
    os="Dumpster OS 26.0 (Trashfire)"
fi

kernel="$(uname -sr 2>/dev/null || echo unknown)"

printf "${GRAY}│${RST}\n"
printf "${GRAY}│${RST} ${BOLD}You are using${RST} %s\n" "$os"
printf "${GRAY}│${RST} ${BOLD}Running on${RST} %s\n" "$kernel"
printf "${GRAY}│${RST}\n"
printf "${GRAY}│${RST} ${GRAY}DumpsterOS comes with ABSOLUTELY NO WARRANTY, to the extent${RST}\n"
printf "${GRAY}│${RST} ${GRAY}permitted by applicable law. Type 'licenses' for details.${RST}\n"
printf "${GRAY}│${RST}\n"
printf "${GRAY}│${RST} ${GRAY}handoff to userspace in progress…${RST}\n"
printf "${GRAY}│${RST}\n"

sleep 0.4

echo ""

# Set up environment
export PS1='\[\033[1;35m\]\w\[\033[0m\] \[\033[1;92m\]@\[\033[0m\] \[\033[1;33m\]\h\[\033[0m\] \[\033[1;92m\]#\[\033[0m\] '
export SHELL="/bin/bash"

# Hand off to shell
exec </dev/console >/dev/console 2>&1
exec setsid cttyhack /bin/bash 2>/dev/null
